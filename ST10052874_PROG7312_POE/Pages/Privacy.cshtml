@page
@model PrivacyModel
@{
    ViewData["Title"] = "Report an issue";
}
<h1>@ViewData["Title"]</h1>

<form method="post" enctype="multipart/form-data">
    <!-- Editbox to enter the location of the issue -->
    <div class="form-group">
        <label for="Location">Location:</label>
        <input type="text" class="form-control" id="Location" name="Location" placeholder="Enter the location" asp-for="Location" required />
        <span asp-validation-for="Location" class="text-danger"></span>
    </div>

    <!-- Listbox displaying the types of issues the user can report -->
    <div class="form-group">
        <label for="Category">Category:</label>
        <select class="form-control" id="Category" name="Category" asp-for="Category" required>
            <option value="">Select category</option>
            <option value="Sanitation">Sanitation</option>
            <option value="Roads">Roads</option>
            <option value="Utilities">Utilities</option>
            <option value="Other">Other</option>
        </select>
        <span asp-validation-for="Category" class="text-danger"></span>
    </div>
    <!-- Editbox to descibe the issue -->
    <div class="form-group">
        <label for="Description">Description:</label>
        <textarea class="form-control" id="Description" name="Description" rows="5" placeholder="Describe the issue in detail" asp-for="Description" required></textarea>
        <span asp-validation-for="Description" class="text-danger"></span>
    </div>
    <!-- Button to add a file attachment -->
    <div class="form-group">
        <label for="MediaAttachment">Attach Media:</label>
        <input type="file" class="form-control-file" id="MediaAttachment" name="MediaAttachment" asp-for="MediaAttachment" accept="image/*,application/pdf" />
        <span asp-validation-for="MediaAttachment" class="text-danger"></span>
    </div>

    <button type="submit" class="btn btn-primary">Submit</button>
</form>
<h2>Submitted Issues</h2>
<!-- List of all submitted reports -->
@if (Model.Issues != null && Model.Issues.Count > 0)
{
    <table class="table table-bordered">
        <thead>
            <tr>
                <th>Location</th>
                <th>Category</th>
                <th>Description</th>
                <th>Media Attachment</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var issue in Model.Issues)
            {
                <tr>
                    <td>@issue.location</td>
                    <td>@issue.category</td>
                    <td>@issue.description</td>
                    <td>
                        @if (issue.mediaAttachment != null)
                        {
                            <a href="@Url.Content("~/uploads/" + issue.mediaAttachment.FileName)">View Attachment</a>
                        }
                        else
                        {
                            <span>No Attachment</span>
                        }
                    </td>
                </tr>
            }
        </tbody>
    </table>
}
else
{
    <p>No issues have been submitted yet.</p>
}

<a asp-page="/Index" class="btn btn-primary btn-block mb-3">
    Return to Main Menu
</a>
